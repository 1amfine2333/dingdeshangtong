<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
	    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
	    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>首页</title>
		<link rel="stylesheet" href="__TMPL__/public/assets/user/lib/mui/mui.min.css" />
		<link rel="stylesheet" href="__TMPL__/public/assets/user/lib/mui/mui.picker.min.css" />
		<link rel="stylesheet" href="__TMPL__/public/assets/user/lib/mui/mui.poppicker.css" />
	    <link rel="stylesheet" href="__TMPL__/public/assets/user/lib/weui/jquery-weui.css" />
	    <link rel="stylesheet" href="__TMPL__/public/assets/user/lib/weui/weui.min.css" />
	    <link rel="stylesheet" href="__TMPL__/public/assets/user/css/public.css" />
	    <link rel="stylesheet" href="__TMPL__/public/assets/user/css/style.css" />
	    <script type="text/javascript" src="__TMPL__/public/assets/user/lib/jq/jquery-1.10.2.js" ></script>
	    <script type="text/javascript" src="__TMPL__/public/assets/user/lib/mui/mui.js" ></script>
	    <script type="text/javascript" src="__TMPL__/public/assets/user/lib/mui/mui.picker.min.js" ></script>
	    <script type="text/javascript" src="__TMPL__/public/assets/user/lib/mui/mui.poppicker.js" ></script>
	    <script type="text/javascript" src="__TMPL__/public/assets/user/lib/weui/jquery-weui.js" ></script>
	    <script type="text/javascript" src="__TMPL__/public/assets/user/js/v.min.js" ></script>
	    <script type="text/javascript" src="__TMPL__/public/assets/user/js/common.js?_=2" ></script>
	</head>
	<style>
		body .weui-vcode-btn.getCode.active{ color: #ccc;}
		body .weui-vcode-btn.getCode{ color: #4c7db2;}
		body .weui-vcode-btn{ font-size: 1rem;}
		.underline{ text-decoration: underline;}
	</style>
	<body class="bgf7">
		<section id="app" class="mainSec">
			<div class="content" style="padding-bottom: 50px;">
				<form action="" id="formData">
				<div class="map">
					<div>
						<img src="__TMPL__/public/assets/user/img/map.png" width="100%" />
					</div>
					<div class="mapInfo">
						<div class="size9 bold">工程地址</div>
						<div class="disbox">
							<div class="disflex size9 address" :class="isedit?'underline':''" :contenteditable="isedit" v-text="project_address"></div>
							<input type="hidden" name="project_address" >
							<div class="pen" @click="isedit=!isedit"></div>
						</div>
					</div>
				</div>
				<div class="weui-cells index bgf7" style="margin: 1rem 1rem 0;">
		            <div class="weui-cell">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/dwmc.png" class="icon" alt="">
		                	单位名称
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="unit_name" maxlength="15"  name="unit_name" placeholder="请输入单位名称" />
		                    <span class="history" data-val="unit_name">{{history.unit_name}}</span>
		                </div>
		                <div class="weui-cell__ft"></div>
		            </div>
		            <div class="weui-cell weui-cell_access">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/gcmc.png" class="icon" alt="">
		                	工程名称
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="project_name" maxlength="15"  name="project_name"  placeholder="请输入/选择工程" />
		                    <span class="history" data-val="project_name">{{history.project_name}}</span>
		                </div>
		                <div class="weui-cell__ft" @click='choseFn($event,1)'> </div>
		            </div>
		            <div class="weui-cell">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/ywy.png" class="icon" alt="">
		                	业务员
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="salesman" maxlength="6"   name="salesman" placeholder="请输入业务员姓名" />
		                    <span class="history" data-val="salesman">{{history.salesman}}</span>
		                </div>
		                <div class="weui-cell__ft"></div>
		            </div>
		            <div class="weui-cell weui-cell_access">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/jzfs.png" class="icon" alt="">
		                	浇筑方式
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="pouring_type"   name="pouring_type" maxlength="10" placeholder="请输入/选择浇筑方式" />
		                    <span class="history" data-val="pouring_type">{{history.pouring_type}}</span>
		                </div>
		                <div class="weui-cell__ft" @click='choseFn($event,2)'> </div>
		            </div>
		            <div class="weui-cell weui-cell_access">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/jzbw.png" class="icon" alt="">
		                	浇筑部位
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="pouring_part"   name="pouring_part" maxlength="10" placeholder="请输入/选择浇筑部位" />
		                    <span class="history" data-val="pouring_part">{{history.pouring_part}}</span>
		                </div>
		                <div class="weui-cell__ft" @click='choseFn($event,3)'> </div>
		            </div>
		            <div class="weui-cell weui-cell_access">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/jzbh.png" class="icon" alt="">
		                	浇筑标号
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="pouring_label"    name="pouring_label" maxlength="10" placeholder="请输入/选择浇筑标号" />
		                    <span class="history" data-val="pouring_label">{{history.pouring_label}}</span>
		                </div>
		                <div class="weui-cell__ft" @click='choseFn($event,4)'> </div>
		            </div>
		            <div class="weui-cell weui-cell_access">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/tld.png" class="icon" alt="">
		                	坍落度
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="slump"   name="slump" maxlength="10" placeholder="请输入/选择坍落度" />
		                    <span class="history" data-val="slump">{{history.slump}}</span>
		                </div>
		                <div class="weui-cell__ft" @click='choseFn($event,5)'> </div>
		            </div>
		            <div class="weui-cell weui-cell_access">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/jzsj.png" class="icon" alt="">
		                	浇筑时间
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="pouring_time"  readonly placeholder="请选择浇筑时间" />
		                    <input type="hidden" name="pouring_time"  value="" />
		                    <span class="history" data-val="pouring_time">{{history.pouring_time}}</span>
		                </div>
		                <div class="weui-cell__ft" onclick="choseTime(this)"> </div>
		            </div>
		            <div class="weui-cell">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/styj.png" class="icon" alt="">
		                	商拓运距
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="distance"   name="distance" maxlength="15" placeholder="请输入商砼运距" />
		                    <span class="history" data-val="distance">{{history.distance}}</span>
		                </div>
		                <div class="weui-cell__ft"> </div>
		            </div>
		            <div class="weui-cell">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/jhfl.png" class="icon" alt="">
		                	计划方量
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="plan_square"   name="plan_square" maxlength="15" placeholder="请输入计划方量" />
		                    <span class="history" data-val="plan_square">{{history.plan_square}}</span>
		                </div>
		                <div class="weui-cell__ft"> </div>
		            </div>
		            <div class="weui-cell">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/xcfz.png" class="icon" alt="">
		                	现场负责
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="principal"   name="principal" maxlength="6" placeholder="请输入现场负责人姓名" />
		                    <span class="history" data-val="principal">{{history.principal}}</span>
		                </div>
		                <div class="weui-cell__ft"> </div>
		            </div>
		            <div class="weui-cell">
		                <div class="weui-cell__hd">
		                	<img src="__TMPL__/public/assets/user/img/lxdh.png" class="icon" alt="">
		                	联系电话
		                </div>
		                <div class="weui-cell__bd relative">
		                    <input type="text" class="right" required v-model="mobile"   name="mobile" placeholder="请输入现场负责人电话" />
		                    <span class="history" data-val="mobile">{{history.mobile}}</span>
		                </div>
		                <div class="weui-cell__ft"> </div>
		            </div>
		        </div>
		        <div class="btn" style="margin-bottom:1rem;" id="submit">提 交</div>
				</form>
			</div>
			
			<footer class="mainFooter">
				<a class="fot1 active">首页</a>
				<a class="fot2" href="{:url('plan/index')}">计划单</a>
				<a class="fot3" href="{:url('user/index')}">我的 {$has_msg?'<i></i>':""}</a>
			</footer>
		</section>
	</body>
</html>
<script>

	const data_category= {:json_encode($category)?:''};
    mui.init();
	let key = "history";
	let _cache = cache(key);
	let app = new Vue({
		el:'#app',
		data:{
            project_address:'四川省成都市成华区二环路东三段212号',    //工程地址
			isedit:false,    //地址是否可编辑
            unit_name:'',     //单位名称
            project_name:'',     //工程名称
            salesman:'',    //业务员
            pouring_type:'',     //浇筑方式
            pouring_part:'',     //浇筑部位
            pouring_label:'',     //浇筑标号
            slump:'',     //坍落度
            pouring_time:'',     //浇筑时间
            distance:'',    //商砼运距
            plan_square:'',    //计划方量
            principal:'',     //现场负责人姓名
            mobile:'',     //现场负责人联系电话
			history:_cache||{
                unit_name:'重庆心联宇科技',     //单位名称
                project_name:'希望工程',     //工程名称
                salesman:'李世民',    //业务员
                pouring_type:'1',     //浇筑方式
                pouring_part:'2',     //浇筑部位
                pouring_label:'180-521-54',     //浇筑标号
                slump:'10',     //坍落度
                pouring_time:'{:date("Y-m-d H:i:s")}',     //浇筑时间
                distance:'100',    //商砼运距
                plan_square:'50',    //计划方量
                principal:'张良',     //现场负责人姓名
                mobile:'18725950959',     //现场负责人联系电话
			},     //历史记录
			gcmcList:[ ],    //工程名称列表
			jzfsList:[ ],    //浇筑方式列表
			jzbwList:[ ],     //浇筑部位列表
			jzfhList:[ ],     //浇筑符号列表
			tldList:[ ],     //坍落度列表
		},
		methods:{
			//点击选择
			choseFn:function(evt,type){
				let self=this,data=null;
				if(type===1){
					  data= self.gcmcList;
				}else if(type===2){
					  data=data_category[2]['subsets'];
				}else if(type===3){
					  data=data_category[3]['subsets'];
				}else if(type===4){
					  data=data_category[1]['subsets'];
				}else{
					  data=data_category[4]['subsets'];
				}
				//$('input').blur();
                let picker = new mui.PopPicker();
				picker.setData(data);
				//picker.pickers[0].setSelectedIndex(4, 2000);
				picker.pickers[0].setSelectedValue('fourth', 2000);
				picker.show(function(SelectedItem) {
					console.log(SelectedItem);
					let text = SelectedItem[0].text;
					if(type===1){
						self.project_name=text ;
						//self.unit_name=SelectedItem[0].value;
					}else if(type===2){
						self.pouring_type=text;
					}else if(type===3){
						self.pouring_part=text;
					}else if(type===4){
						self.pouring_label=text;
					}else{
						self.slump=text;
					}
				})
			}

		},
		watch:{
			
		}
	});

	$("#submit").on("click",function () {

        var project_address=$('.address').text();
        $("[name=project_address]").val(project_address);

        let data = $("#formData").formData();

		for(let i in data){
            if(!data[i].length){
                $.toast("请完善计划单信息!","cancel");return;
			}
		}
        if(!testTel(data.mobile)){
            $.toast("请输入正确格式手机号!","cancel");
            return
        }
        request({
            url:"{:url('index/indexPost')}",
            data:data,
			done:function (result) {
                cache(key,data);
				result.url&&(location = result.url)
            }
        })

    });


	//选择时间
	function choseTime(obj){
		/*mui.init();*/
		$('input').blur();
		setTimeout(function(){
			var dtpickerStartTime = new mui.DtPicker({
				type : "hour",
				beginDate:new Date(),
				endDate:'',
				labels: ['年', '月', '日', '点'],//设置默认标签区域提示语 
				customData : {
				}
			});
			dtpickerStartTime.show(function(e){
				app.pouring_time=e.y.value+"年"+e.m.value+"月"+e.d.value+"日"+e.h.value+"点";
//				$(obj).find('input').val(e.y.value+"年"+e.m.value+"月"+e.d.value+"日");
    			$('input[name=pouring_time]').val(e.text+":00:00");
			})
		},500)
	}
	$(function(){
		//输入框获得焦点，读取历史记录
		$('input').focus(function(){
			$('.history').hide();
			var hist=$(this).siblings('.history');
			if(hist.html()!=''){
				hist.show();
			}
		});
		
		//点击历史记录，填充内容至输入框
		$('.history').click(function(){
			var val=$(this).attr('data-val');
			var script = "app."+val +"=$(this).html()";
			if(val==='pouring_time'){
                $('input[name=pouring_time]').val($(this).html());
			}
			eval(script); $(this).hide();
		})
	})

</script>





